[Unit]
Description=OpenZiti Router
After=network-online.target

[Service]
Type=simple

# manage the user and permissions for the service automatically
DynamicUser=yes

# this env file configures the service, including whether or not to perform bootstrapping
EnvironmentFile=/opt/openziti/etc/router/service.env

# relative to /var/lib
StateDirectory=ziti-router
WorkingDirectory=/var/lib/ziti-router

ExecStartPre=/opt/openziti/etc/router/entrypoint.bash check config.yml
ExecStart=/opt/openziti/bin/ziti router run config.yml ${ZITI_ARGS}

Restart=always
RestartSec=3

LimitNOFILE=65535
UMask=0007

# allow binding low ports, e.g., 443/tcp; required when ZITI_ROUTER_MODE=tproxy or ZITI_ROUTER_PORT <= 1024
#AmbientCapabilities=CAP_NET_BIND_SERVICE

# allow adding IP routes and iptables rules; required when ZITI_ROUTER_MODE=tproxy
#AmbientCapabilities=CAP_NET_ADMIN

[Install]
WantedBy=multi-user.target
